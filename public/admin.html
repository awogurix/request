<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ラジオ番組の管理画面">
  <meta name="theme-color" content="#667eea">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="管理画面">
  <title>管理画面 | ラジオ番組</title>
  
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/icons/icon-192x192.png">
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <svg class="icon-radio" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M2 16.1A5 5 0 0 1 5.9 20M2 12.05A9 9 0 0 1 9.95 20M2 8V6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-6"></path>
            <line x1="2" y1="20" x2="2.01" y2="20"></line>
          </svg>
          <h1>曲リクエスト</h1>
        </div>
        <nav class="nav">
          <a href="/" class="nav-link">リクエスト</a>
          <a href="/today.html" class="nav-link">今日のリクエスト</a>
          <a href="/playlist.html" class="nav-link">プレイリスト</a>
          <a href="/admin.html" class="nav-link active">管理画面</a>
        </nav>
      </div>
    </header>

    <main class="main">
      <!-- ログイン画面 -->
      <div id="loginSection" class="card">
        <div class="card-header">
          <h2>管理者ログイン</h2>
          <p>管理画面にアクセスするにはパスワードを入力してください</p>
        </div>

        <form id="loginForm" class="form">
          <div class="form-group">
            <label for="password" class="form-label">パスワード</label>
            <input 
              type="password" 
              id="password" 
              name="password" 
              class="form-input"
              required
              placeholder="管理者パスワードを入力"
            >
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary">ログイン</button>
          </div>
        </form>

        <div id="loginError" class="alert alert-error" style="display: none;">
          <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
          <div>
            <strong>ログインエラー</strong>
            <p id="loginErrorText"></p>
          </div>
        </div>
      </div>

      <!-- 管理画面メイン -->
      <div id="adminSection" style="display: none;">
        <!-- 統計カード -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">総リクエスト数</div>
            <div class="stat-value" id="statTotal">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">本日のリクエスト</div>
            <div class="stat-value" id="statToday">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">未選曲</div>
            <div class="stat-value" id="statUnread">0</div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>リクエスト管理</h2>
            <div class="header-actions">
              <button id="logoutBtn" class="btn btn-secondary">ログアウト</button>
            </div>
          </div>

          <!-- 受付状態切り替え -->
          <div class="request-status-control">
            <div class="status-info">
              <span class="status-label">リクエスト受付状態:</span>
              <span id="statusBadge" class="status-badge status-enabled">受付中</span>
            </div>
            <button id="toggleStatusBtn" class="btn btn-primary">受付状態を変更</button>
          </div>

          <!-- 次回配信情報設定 -->
          <div class="card-body" style="border-top: 1px solid #E0E0E0; padding-top: 25px; margin-top: 25px;">
            <h3 style="margin-bottom: 20px; font-size: 18px;">次回配信情報</h3>
            
            <form id="nextBroadcastForm" style="max-width: 600px;">
              <div class="form-group">
                <label for="nextThemeInput" class="form-label">次回のテーマ</label>
                <input 
                  type="text" 
                  id="nextThemeInput" 
                  class="form-input"
                  maxlength="100"
                  placeholder="例: 春の新曲特集"
                >
                <div style="color: #666; font-size: 12px; margin-top: 5px;">
                  空欄の場合、リクエストページに表示されません
                </div>
              </div>

              <div class="form-group">
                <label for="nextTimeInput" class="form-label">配信予定日時</label>
                <input 
                  type="text" 
                  id="nextTimeInput" 
                  class="form-input"
                  maxlength="50"
                  placeholder="例: 明日の夜 または 12月25日 夜"
                >
                <div style="color: #666; font-size: 12px; margin-top: 5px;">
                  空欄の場合、リクエストページに表示されません
                </div>
              </div>

              <button type="submit" class="btn btn-primary">更新</button>
            </form>

            <div id="broadcastSuccess" class="alert alert-success" style="display: none; margin-top: 20px;">
              <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
              </svg>
              <div>
                <strong>更新しました</strong>
                <p>次回配信情報が正常に更新されました</p>
              </div>
            </div>

            <div id="broadcastError" class="alert alert-error" style="display: none; margin-top: 20px;">
              <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
              </svg>
              <div>
                <strong>エラー</strong>
                <p id="broadcastErrorText"></p>
              </div>
            </div>
          </div>

          <div class="admin-controls">
            <div class="filter-group">
              <label for="dateFilter">日付フィルター:</label>
              <input type="date" id="dateFilter" class="form-input">
              <button id="clearFilter" class="btn btn-secondary">全期間</button>
            </div>
            <div class="export-group">
              <button id="exportBtn" class="btn btn-primary">CSVエクスポート</button>
            </div>
          </div>

          <div id="adminRequestsList" class="admin-requests-list">
            <div class="loading">読み込み中...</div>
          </div>

          <div id="noAdminRequests" class="no-data" style="display: none;">
            <svg class="no-data-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 18V5l12-2v13M6 14H4c-1.1 0-2 .9-2 2v4c0 1.1.9 2 2 2h2c1.1 0 2-.9 2-2v-4c0-1.1-.9-2-2-2zM18 16h-2c-1.1 0-2 .9-2 2v2c0 1.1.9 2 2 2h2c1.1 0 2-.9 2-2v-2c0-1.1-.9-2-2-2z"></path>
            </svg>
            <p>リクエストがありません</p>
          </div>
        </div>

        <!-- プレイリスト管理セクション -->
        <div class="card playlist-form">
          <div class="card-header">
            <h2>プレイリスト管理</h2>
            <p>プレイリストのリンクを追加・管理できます</p>
          </div>

          <form id="playlistForm" class="form">
            <div class="form-group">
              <label for="playlistTitle" class="form-label required">タイトル</label>
              <input 
                type="text" 
                id="playlistTitle" 
                name="title" 
                class="form-input"
                maxlength="200"
                required
                placeholder="例: 10月のおすすめプレイリスト"
              >
            </div>

            <div class="form-group">
              <label for="playlistUrl" class="form-label required">URL</label>
              <input 
                type="url" 
                id="playlistUrl" 
                name="url" 
                class="form-input"
                maxlength="500"
                required
                placeholder="例: https://open.spotify.com/playlist/..."
              >
            </div>

            <div class="form-group">
              <label for="playlistDescription" class="form-label">説明（任意）</label>
              <textarea 
                id="playlistDescription" 
                name="description" 
                class="form-textarea"
                maxlength="500"
                rows="3"
                placeholder="プレイリストの説明を入力してください（500文字まで）"
              ></textarea>
              <div class="char-count">
                <span id="playlistCharCount">0</span> / 500文字
              </div>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-primary" id="addPlaylistBtn">
                プレイリストを追加
              </button>
            </div>
          </form>

          <div id="playlistSuccess" class="alert alert-success" style="display: none; margin-top: 20px;">
            <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            <div>
              <strong>追加しました</strong>
              <p>プレイリストが正常に追加されました</p>
            </div>
          </div>

          <div id="playlistError" class="alert alert-error" style="display: none; margin-top: 20px;">
            <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <div>
              <strong>エラー</strong>
              <p id="playlistErrorText"></p>
            </div>
          </div>

          <div style="margin-top: 30px;">
            <h3 style="margin-bottom: 15px;">登録済みプレイリスト</h3>
            <div id="adminPlaylistsList" class="admin-requests-list">
              <div class="loading">読み込み中...</div>
            </div>
            <div id="noAdminPlaylists" class="no-data" style="display: none;">
              <p>プレイリストがありません</p>
            </div>
          </div>
        </div>

        <!-- お知らせ管理セクション -->
        <div class="card">
        <div class="card-header">
          <h2>お知らせ管理</h2>
          <p>お知らせを投稿すると、通知をオンにしているユーザーにプッシュ通知が届きます</p>
        </div>

        <div class="card-body">
          <form id="announcementForm" class="form">
            <div class="form-group">
              <label for="announcementTitle" class="form-label required">お知らせタイトル</label>
              <input 
                type="text" 
                id="announcementTitle" 
                class="form-input"
                maxlength="100"
                required
                placeholder="例: 次回配信のお知らせ"
              >
            </div>

            <div class="form-group">
              <label for="announcementMessage" class="form-label required">お知らせ内容</label>
              <textarea 
                id="announcementMessage" 
                class="form-input"
                rows="4"
                maxlength="500"
                required
                placeholder="お知らせの詳細を入力してください"
              ></textarea>
              <div class="char-counter">
                <span id="announcementCharCount">0</span> / 500
              </div>
            </div>

            <button type="submit" id="sendAnnouncementBtn" class="btn btn-primary">
              プッシュ通知を送信
            </button>
          </form>

          <div id="announcementSuccess" class="alert alert-success" style="display: none; margin-top: 20px;">
            <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            <div>
              <strong>送信しました</strong>
              <p id="announcementSuccessText"></p>
            </div>
          </div>

          <div id="announcementError" class="alert alert-error" style="display: none; margin-top: 20px;">
            <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <div>
              <strong>エラー</strong>
              <p id="announcementErrorText"></p>
            </div>
          </div>

          <div style="margin-top: 30px;">
            <h3 style="margin-bottom: 15px;">お知らせ履歴</h3>
            <div id="announcementsList" class="admin-requests-list">
              <div class="loading">読み込み中...</div>
            </div>
            <div id="noAnnouncements" class="no-data" style="display: none;">
              <p>お知らせがありません</p>
            </div>
          </div>
        </div>
      </div>

      <!-- バックアップ管理セクション -->
      <div class="card">
        <div class="card-header">
          <h2>バックアップ管理</h2>
          <p>データベースのバックアップを作成・復元できます</p>
        </div>

        <div class="card-body">
          <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <button type="button" id="createBackupBtn" class="btn btn-primary">
              手動バックアップ作成
            </button>
            <button type="button" id="refreshBackupsBtn" class="btn btn-secondary">
              一覧を更新
            </button>
          </div>

          <div id="backupSuccess" class="alert alert-success" style="display: none; margin-bottom: 20px;">
            <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            <div>
              <strong>成功</strong>
              <p id="backupSuccessText"></p>
            </div>
          </div>

          <div id="backupError" class="alert alert-error" style="display: none; margin-bottom: 20px;">
            <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <div>
              <strong>エラー</strong>
              <p id="backupErrorText"></p>
            </div>
          </div>

          <div style="margin-top: 30px;">
            <h3 style="margin-bottom: 15px;">バックアップ一覧</h3>
            <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
              自動バックアップはサーバー起動時と1時間ごとに実行されます。最大10件まで保持されます。
            </p>
            <div id="backupsList" class="admin-requests-list">
              <div class="loading">読み込み中...</div>
            </div>
            <div id="noBackups" class="no-data" style="display: none;">
              <p>バックアップファイルがありません</p>
            </div>
          </div>
        </div>
      </div>
      </div>
    </main>

    <footer class="footer">
      <p>&copy; 2024 Radio Request System. All rights reserved.</p>
    </footer>
  </div>

  <script src="/js/admin.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch((error) => {
          console.log('Service Worker registration failed:', error);
        });
      });
    }
  </script>
</body>
</html>
