<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ラジオ番組へのラジオっぽい部屋 by clubhouseを受け付けています。お好きな曲をリクエストしてください。">
  <meta name="theme-color" content="#667eea">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="ラジオっぽい部屋 by clubhouse">
  <title>ラジオっぽい部屋 by clubhouse | ラジオ番組</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json?v=15">
  
  <!-- Icons -->
  <link rel="icon" type="image/x-icon" href="/icons/favicon.ico?v=15">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192x192.png?v=15">
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png?v=15">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <svg class="icon-radio" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M2 16.1A5 5 0 0 1 5.9 20M2 12.05A9 9 0 0 1 9.95 20M2 8V6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-6"></path>
            <line x1="2" y1="20" x2="2.01" y2="20"></line>
          </svg>
          <h1><span class="logo-main">ラジオっぽい部屋</span> <span class="logo-sub">by clubhouse</span></h1>
          <button id="jingleBtn" class="jingle-link" title="番組ジングルを見る" aria-label="番組ジングルを見る">
            🎵 ジングル
          </button>
        </div>
        <button class="menu-toggle" id="menuToggle" aria-label="メニューを開く">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <nav class="nav" id="mainNav">
          <a href="/" class="nav-link active">リクエスト</a>
          <a href="/today.html" class="nav-link">最新のリクエスト</a>
          <a href="/theme-request.html" class="nav-link">テーマ募集</a>
          <a href="/feedback.html" class="nav-link">フィードバック</a>
          <a href="/playlist.html" class="nav-link">プレイリスト</a>
          <a href="/admin.html" class="nav-link">管理画面</a>
        </nav>
      </div>
    </header>

    <div class="menu-overlay" id="menuOverlay"></div>

    <main class="main">
      <!-- 受付停止メッセージ（停止中のみ表示） -->
      <div id="closedNotice" class="closed-notice" style="display: none;">
        <div class="closed-notice-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
        </div>
        <div class="closed-notice-content">
          <h2>現在、リクエストの受付を停止しています</h2>
          <p>大変申し訳ございません。現在リクエストの受付を一時停止させていただいております。</p>
          <p>受付再開までしばらくお待ちください。</p>
          <div class="theme-suggestion-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 11l3 3L22 4"></path>
              <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
            <strong>テーマの募集は受付中です！</strong>
            <a href="/theme-request.html">こちらから番組テーマを提案できます →</a>
          </div>
        </div>
      </div>

      <!-- 次回配信情報 -->
      <div id="nextBroadcastInfo" class="next-broadcast-info" style="display: none;">
        <div class="next-broadcast-header">
          <svg class="next-broadcast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          <h3>次回の配信について</h3>
        </div>
        <div class="next-broadcast-content">
          <div id="nextTheme" class="next-broadcast-item" style="display: none;">
            <span class="next-broadcast-label">テーマ:</span>
            <span id="nextThemeValue" class="next-broadcast-value"></span>
          </div>
          <div id="nextTime" class="next-broadcast-item" style="display: none;">
            <span class="next-broadcast-label">配信予定:</span>
            <span id="nextTimeValue" class="next-broadcast-value"></span>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2>あなたのリクエストをお待ちしています</h2>
          <p>お好きな曲をリクエストしてください。番組でご紹介させていただきます。</p>
        </div>

        <!-- 注意事項 -->
        <div class="notice-box">
          <div class="notice-header">
            <svg class="notice-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <span>ご注意事項</span>
          </div>
          <ul class="notice-list">
            <li>リクエスト曲は、私の独断偏見で選曲させていただきます。（リクエスト曲は必ず配信で再生されるわけではないことをご了承ください）</li>
            <li>リクエスト曲数の上限はございません。</li>
          </ul>
        </div>

        <form id="requestForm" class="form">
          <div class="form-group">
            <label for="songName" class="form-label required">曲名</label>
            <input 
              type="text" 
              id="songName" 
              name="song_name" 
              class="form-input" 
              maxlength="100"
              required
              placeholder="例: 夜に駆ける"
            >
          </div>

          <div class="form-group">
            <label for="artistName" class="form-label required">アーティスト名</label>
            <input 
              type="text" 
              id="artistName" 
              name="artist_name" 
              class="form-input"
              maxlength="100"
              required
              placeholder="例: YOASOBI"
            >
          </div>

          <div class="form-group">
            <label for="nickname" class="form-label required">ラジオネーム</label>
            <input 
              type="text" 
              id="nickname" 
              name="nickname" 
              class="form-input"
              maxlength="50"
              required
              placeholder="例: ゆうきん"
            >
          </div>

          <div class="form-group">
            <label for="message" class="form-label">メッセージ（任意）</label>
            <textarea 
              id="message" 
              name="message" 
              class="form-textarea"
              maxlength="300"
              rows="4"
              placeholder="DJへのメッセージや、この曲への思い出などをお書きください（300文字まで）"
            ></textarea>
            <div class="char-count">
              <span id="charCount">0</span> / 300文字
            </div>
          </div>

          <!-- 確認チェックボックス -->
          <div class="form-group confirmation-box">
            <div class="confirmation-message">
              <p class="confirmation-title">リクエストありがとうございます！</p>
              <p class="confirmation-text">時間の制限、配信の流れや雰囲気などの様々な理由でリクエストした曲が流れない場合もございます。</p>
              <p class="confirmation-question">ご了承いただけますか？</p>
            </div>
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                id="agreement" 
                name="agreement" 
                class="checkbox-input"
                required
              >
              <span class="checkbox-text">はい！</span>
            </label>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary" id="submitBtn">
              リクエストを送信
            </button>
          </div>
        </form>

        <!-- PWAインストール案内 -->
        <div class="pwa-install-card">
          <div class="pwa-install-content">
            <div class="pwa-install-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
            </div>
            <div class="pwa-install-text">
              <h3>📱 アプリとして使えます！</h3>
              <p>ホーム画面に追加すると、アプリのように快適に利用できます。</p>
              <p>✨ リクエスト受付再開やプレイリスト公開の通知も届きます！</p>
              <a href="https://mfucdfhf.gensparkspace.com/" target="_blank" rel="noopener noreferrer" class="pwa-learn-more">
                📖 インストール方法を見る →
              </a>
            </div>
          </div>
        </div>

        <div id="successMessage" class="alert alert-success" style="display: none;">
          <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          <div>
            <strong>リクエストを受け付けました！</strong>
            <p>ありがとうございます。番組でご紹介させていただきます。</p>
          </div>
        </div>

        <div id="errorMessage" class="alert alert-error" style="display: none;">
          <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
          <div>
            <strong>エラーが発生しました</strong>
            <p id="errorText"></p>
          </div>
        </div>
      </div>

      <div class="info-card">
        <h3>リクエストについて</h3>
        <ul class="info-list">
          <li>受付したリクエストは「最新のリクエスト」ページでご確認いただけます</li>
          <li>番組内で全てのリクエストにお応えできない場合があります</li>
          <li>不適切な内容のリクエストは削除させていただく場合があります</li>
          <li>短時間に複数のリクエストを送信することはできません</li>
        </ul>
      </div>
    </main>

    <footer class="footer">
      <p>&copy; 2024 Radio Request System. All rights reserved.</p>
    </footer>
  </div>

  <script src="/js/index.js?v=15"></script>
  <!-- <script src="/js/pwa-install.js"></script> --> <!-- PWA install prompt disabled -->
  <script src="/js/push-notification.js"></script>
  
  <!-- PWA Service Worker Registration -->
  <script>
    // Service Worker を完全に削除
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(function(registrations) {
        for(let registration of registrations) {
          registration.unregister();
          console.log('Service Worker unregistered');
        }
      });
      
      // キャッシュも完全削除
      if ('caches' in window) {
        caches.keys().then(function(cacheNames) {
          cacheNames.forEach(function(cacheName) {
            caches.delete(cacheName);
            console.log('Cache deleted:', cacheName);
          });
        });
      }
    }
  </script>

  <!-- ジングルモーダル -->
  <div id="jingleModal" class="jingle-modal">
    <div class="jingle-modal-overlay"></div>
    <div class="jingle-modal-content">
      <button class="jingle-modal-close" aria-label="閉じる">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      <div class="jingle-modal-header">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="5 3 19 12 5 21 5 3"></polygon>
        </svg>
        <h3>番組ジングル</h3>
      </div>
      <div class="jingle-modal-body">
        <video id="jingleVideo" class="jingle-modal-video" controls poster="/icons/icon-512x512.png">
          <source src="/media/jingle.mp4" type="video/mp4">
          お使いのブラウザは動画タグをサポートしていません。
        </video>
      </div>
    </div>
  </div>

  <script src="/js/menu.js?v=24"></script>
</body>
</html>
