<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ラジオ番組への曲リクエストを受け付けています。お好きな曲をリクエストしてください。">
  <meta name="theme-color" content="#667eea">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="曲リクエスト">
  <title>曲リクエスト | ラジオ番組</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  
  <!-- Icons -->
  <link rel="icon" href="/icons/icon-192x192.png">
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <svg class="icon-radio" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M2 16.1A5 5 0 0 1 5.9 20M2 12.05A9 9 0 0 1 9.95 20M2 8V6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-6"></path>
            <line x1="2" y1="20" x2="2.01" y2="20"></line>
          </svg>
          <h1>曲リクエスト</h1>
        </div>
        <nav class="nav">
          <a href="/" class="nav-link active">リクエスト</a>
          <a href="/today.html" class="nav-link">今日のリクエスト</a>
          <a href="/playlist.html" class="nav-link">プレイリスト</a>
          <a href="/admin.html" class="nav-link">管理画面</a>
        </nav>
      </div>
    </header>

    <main class="main">
      <!-- 受付停止メッセージ（停止中のみ表示） -->
      <div id="closedNotice" class="closed-notice" style="display: none;">
        <div class="closed-notice-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
        </div>
        <div class="closed-notice-content">
          <h2>現在、リクエストの受付を停止しています</h2>
          <p>大変申し訳ございません。現在リクエストの受付を一時停止させていただいております。</p>
          <p>受付再開までしばらくお待ちください。</p>
        </div>
      </div>

      <!-- 次回配信情報 -->
      <div id="nextBroadcastInfo" class="next-broadcast-info" style="display: none;">
        <div class="next-broadcast-header">
          <svg class="next-broadcast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          <h3>次回の配信について</h3>
        </div>
        <div class="next-broadcast-content">
          <div id="nextTheme" class="next-broadcast-item" style="display: none;">
            <span class="next-broadcast-label">テーマ:</span>
            <span id="nextThemeValue" class="next-broadcast-value"></span>
          </div>
          <div id="nextTime" class="next-broadcast-item" style="display: none;">
            <span class="next-broadcast-label">配信予定:</span>
            <span id="nextTimeValue" class="next-broadcast-value"></span>
          </div>
        </div>
      </div>

      <!-- プッシュ通知設定 -->
      <div class="push-notification-card" id="pushNotificationCard" style="display: none;">
        <div class="push-notification-content">
          <div class="push-notification-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
              <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
          </div>
          <div class="push-notification-text">
            <strong>お知らせ通知</strong>
            <p>新しいお知らせがあるとスマホに通知が届きます</p>
          </div>
          <button id="push-subscribe-button" class="btn btn-primary" onclick="window.pushNotification.subscribe()">
            通知をオンにする
          </button>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2>あなたのリクエストをお待ちしています</h2>
          <p>お好きな曲をリクエストしてください。番組でご紹介させていただきます。</p>
        </div>

        <!-- 注意事項 -->
        <div class="notice-box">
          <div class="notice-header">
            <svg class="notice-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <span>ご注意事項</span>
          </div>
          <ul class="notice-list">
            <li>リクエスト曲は、私の独断偏見で選曲させていただきます。（リクエスト曲は必ず配信で再生されるわけではないことをご了承ください）</li>
            <li>次回の配信の1時間前にリクエストの受付を停止させていただきます。</li>
            <li>配信中はリクエストを受け付けませんので、ご了承ください。</li>
          </ul>
        </div>

        <form id="requestForm" class="form">
          <div class="form-group">
            <label for="songName" class="form-label required">曲名</label>
            <input 
              type="text" 
              id="songName" 
              name="song_name" 
              class="form-input" 
              maxlength="100"
              required
              placeholder="例: 夜に駆ける"
            >
          </div>

          <div class="form-group">
            <label for="artistName" class="form-label required">アーティスト名</label>
            <input 
              type="text" 
              id="artistName" 
              name="artist_name" 
              class="form-input"
              maxlength="100"
              required
              placeholder="例: YOASOBI"
            >
          </div>

          <div class="form-group">
            <label for="nickname" class="form-label required">ラジオネーム</label>
            <input 
              type="text" 
              id="nickname" 
              name="nickname" 
              class="form-input"
              maxlength="50"
              required
              placeholder="例: ゆうきん"
            >
          </div>

          <div class="form-group">
            <label for="message" class="form-label">メッセージ（任意）</label>
            <textarea 
              id="message" 
              name="message" 
              class="form-textarea"
              maxlength="300"
              rows="4"
              placeholder="DJへのメッセージや、この曲への思い出などをお書きください（300文字まで）"
            ></textarea>
            <div class="char-count">
              <span id="charCount">0</span> / 300文字
            </div>
          </div>

          <div class="form-group">
            <label for="captcha" class="form-label required">計算問題（スパム防止）</label>
            <div class="captcha-container">
              <span id="captchaQuestion" class="captcha-question">読み込み中...</span>
              <input 
                type="text" 
                id="captcha" 
                name="captcha" 
                class="form-input captcha-input"
                required
                placeholder="答え"
                autocomplete="off"
              >
              <button type="button" id="refreshCaptcha" class="btn-refresh">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                </svg>
              </button>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary" id="submitBtn">
              リクエストを送信
            </button>
          </div>
        </form>

        <div id="successMessage" class="alert alert-success" style="display: none;">
          <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          <div>
            <strong>リクエストを受け付けました！</strong>
            <p>ありがとうございます。番組でご紹介させていただきます。</p>
          </div>
        </div>

        <div id="errorMessage" class="alert alert-error" style="display: none;">
          <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
          <div>
            <strong>エラーが発生しました</strong>
            <p id="errorText"></p>
          </div>
        </div>
      </div>

      <div class="info-card">
        <h3>リクエストについて</h3>
        <ul class="info-list">
          <li>受付したリクエストは「今日のリクエスト」ページでご確認いただけます</li>
          <li>番組内で全てのリクエストにお応えできない場合があります</li>
          <li>不適切な内容のリクエストは削除させていただく場合があります</li>
          <li>短時間に複数のリクエストを送信することはできません</li>
        </ul>
      </div>
    </main>

    <footer class="footer">
      <p>&copy; 2024 Radio Request System. All rights reserved.</p>
    </footer>
  </div>

  <script src="/js/index.js"></script>
  <!-- <script src="/js/pwa-install.js"></script> --> <!-- PWA install prompt disabled -->
  <script src="/js/push-notification.js"></script>
  
  <!-- PWA Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('Service Worker registered successfully:', registration.scope);
            
            // プッシュ通知カードを表示
            if (window.pushNotification && window.pushNotification.isSupported()) {
              const pushCard = document.getElementById('pushNotificationCard');
              if (pushCard) {
                pushCard.style.display = 'block';
              }
            }
          })
          .catch((error) => {
            console.log('Service Worker registration failed:', error);
          });
      });
    }
  </script>
</body>
</html>
